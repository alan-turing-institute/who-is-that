{% extends "index.html" %}

<script type="text/javascript" src="/js/script.js"></script>

{% block title %}
    Process File
{% endblock %}

{% block content %}

    {% if cover_url %}
        <img src="{{ cover_url }}" alt="EPUB Cover" class="image" />
    {% else %}
        <h1>{{ title }}</h1>
        <h2>{{ author }}</h2>
    {% endif %}

    <script>
        // Attach scripts after the DOM content is loaded
        document.addEventListener("DOMContentLoaded", () => {
            const dynamicContent = document.getElementById("dynamic-content");
            if (dynamicContent) {
                // Add a context menu when the dynamic-content div is clicked
                dynamicContent.addEventListener("contextmenu", (event) => showContextMenu(event));
                // Disable the context menu when other clicks are made
                document.addEventListener("click", (event) => hideContextMenu(event));
            }
        });
    </script>

    <div id="dynamic-content">
        {% if html_user_content %}
            {{ html_user_content|safe }}
        {% endif %}
    </div>

    <div id="summary-modal">
        <!-- Intentionally blank -->
    </div>

    <div id="dropdown">
    <ul>
        <li onclick="submitQuery('summarise')">Summarise</li>
        <li onclick="submitQuery('who_is_that')">Who is that?</li>
        <li onclick="submitQuery('what_is_this')">What is that?</li>
    </ul>
    </div>

    <form id="query-form" method="POST" action="/query">
        <input type="hidden" name="author" id="author" value="{{ author }}" />
        <input type="hidden" name="option" id="option" />
        <input type="hidden" name="selected_text_context" id="selected-text-context" />
        <input type="hidden" name="selected_text" id="selected-text" />
        <input type="hidden" name="title" id="title" value="{{ title }}" />
    </form>

{% endblock %}
